/*! 
 Build based on gin-vue-admin 
 Time : 1654839698000 */
var e=(e,a,t)=>new Promise(((s,o)=>{var r=e=>{try{l(t.next(e))}catch(a){o(a)}},n=e=>{try{l(t.throw(e))}catch(a){o(a)}},l=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,n);l((t=t.apply(e,a)).next())}));import{e as a}from"./gin-vue-admin-api.16548396980002.js";import{s as t,r as s,b as o,o as r,c as n,d as l,e as i,w as c,h as d,i as u}from"../gva/gin-vue-admin-index.1654839698000.js";const p={class:"clearflex"},h=d("确 定"),y={name:"Apis"},v=Object.assign(y,{props:{row:{default:function(){return{}},type:Object}},setup(d,{expose:y}){const v=d,f=s({children:"children",label:"description"}),m=s([]),b=s([]),g=s("");(()=>{e(this,null,(function*(){const e=(yield a()).data.apis;m.value=I(e);const s=yield(o={authorityId:v.row.authorityId},t({url:"/casbin/getPolicyPathByAuthorityId",method:"post",data:o}));var o;g.value=v.row.authorityId,b.value=[],s.data.paths&&s.data.paths.forEach((e=>{b.value.push("p:"+e.path+"m:"+e.method)}))}))})();const k=s(!1),x=()=>{k.value=!0},I=e=>{const a={};e&&e.forEach((e=>{e.onlyId="p:"+e.path+"m:"+e.method,Object.prototype.hasOwnProperty.call(a,e.apiGroup)?a[e.apiGroup].push(e):Object.assign(a,{[e.apiGroup]:[e]})}));const t=[];for(const s in a){const e={ID:s,description:s+"组",children:a[s]};t.push(e)}return t},w=s(null),j=()=>e(this,null,(function*(){const e=w.value.getCheckedNodes(!0);var a=[];e&&e.forEach((e=>{var t={path:e.path,method:e.method};a.push(t)}));var s;0===(yield(s={authorityId:g.value,casbinInfos:a},t({url:"/casbin/updateCasbin",method:"post",data:s}))).code&&u({type:"success",message:"api设置成功"})}));return y({needConfirm:k,enterAndNext:()=>{j()}}),(e,a)=>{const t=o("el-button"),s=o("el-tree");return r(),n("div",null,[l("div",p,[i(t,{class:"fl-right",size:"small",type:"primary",onClick:j},{default:c((()=>[h])),_:1})]),i(s,{ref_key:"apiTree",ref:w,data:m.value,"default-checked-keys":b.value,props:f.value,"default-expand-all":"","highlight-current":"","node-key":"onlyId","show-checkbox":"",onCheck:x},null,8,["data","default-checked-keys","props"])])}}});export{v as default};
