/*! 
 Build based on gin-vue-admin 
 Time : 1654836743000 */
import{s as e,_ as t,r as a,j as s,b as o,o as i,c as l,e as n,w as r,y as d,h as u,i as c}from"../gva/gin-vue-admin-index.1654836743000.js";const h=t=>e({url:"/fileUploadAndDownload/getFileList",method:"post",data:t}),p=t=>e({url:"/fileUploadAndDownload/deleteFile",method:"post",data:t}),m=t=>e({url:"/fileUploadAndDownload/editFileName",method:"post",data:t});class f{constructor(e,t,a=1920){this.file=e,this.fileSize=t,this.maxWH=a}compress(){const e=this.file.type,t=this.file.size/1024;return new Promise((a=>{const s=new FileReader;s.readAsDataURL(this.file),s.onload=()=>{const o=document.createElement("canvas"),i=document.createElement("img");i.src=s.result,i.onload=()=>{const s=o.getContext("2d"),l=this.dWH(i.width,i.height,this.maxWH);o.width=l.width,o.height=l.height,s.clearRect(0,0,o.width,o.height),s.drawImage(i,0,0,o.width,o.height);const n=o.toDataURL(e,.9),r=this.fileSizeKB(n);r>this.fileSize&&console.log("图片尺寸太大!"+t+" >> "+r);const d=this.dataURLtoBlob(n,e),u=new File([d],this.file.name);a(u)}}}))}dWH(e,t,a){const s={width:e,height:t};return Math.max(e,t)>a?e>t?(s.width=a,s.height=Math.round(t*(a/e)),s):(s.height=a,s.width=Math.round(e*(a/t)),s):s}fileSizeKB(e){let t=0;return t=Math.round(3*e.split(",")[1].length/4/1024),t}dataURLtoBlob(e,t){const a=atob(e.split(",")[1]);let s=e.split(",")[0].split(":")[1].split(";")[0];const o=new ArrayBuffer(a.length),i=new Uint8Array(o);for(let l=0;l<a.length;l++)i[l]=a.charCodeAt(l);return t&&(s=t),new Blob([o],{type:s,lastModifiedDate:new Date})}}const g=u("压缩上传"),w={name:"UploadImage",methods:{}};var y=t(Object.assign(w,{props:{imageUrl:{type:String,default:""},fileSize:{type:Number,default:2048},maxWH:{type:Number,default:1920}},emits:["on-success"],setup(e,{emit:t}){const u=e,h=a("/api"),p=s(),m=e=>{const t="image/jpeg"===e.type,a="image/png"===e.type;if(!t&&!a)return c.error("上传头像图片只能是 jpg或png 格式!"),!1;const s=e.size/1024<u.fileSize;if(!s){return new f(e,u.fileSize,u.maxWH).compress()}return s},w=e=>{const{data:a}=e;a.file&&t("on-success",a.file.url)};return(e,t)=>{const a=o("el-button"),s=o("el-upload");return i(),l("div",null,[n(s,{action:`${h.value}/fileUploadAndDownload/upload`,headers:{"x-token":d(p).token},"show-file-list":!1,"on-success":w,"before-upload":m,multiple:!1},{default:r((()=>[n(a,{size:"small",type:"primary"},{default:r((()=>[g])),_:1})])),_:1},8,["action","headers"])])}}}),[["__scopeId","data-v-15c9badb"]]);const b=u("普通上传"),U={name:"UploadCommon",methods:{}},v=Object.assign(U,{emits:["on-success"],setup(e,{emit:t}){const u=a("/api"),h=s(),p=a(!1),m=e=>{p.value=!0;const t="image/jpeg"===e.type,a="image/png"===e.type,s=e.size/1024/1024<.5;return t||a||(c.error("上传图片只能是 jpg或png 格式!"),p.value=!1),s||(c.error("未压缩未见上传图片大小不能超过 500KB，请使用压缩上传"),p.value=!1),(a||t)&&s},f=e=>{const{data:a}=e;a.file&&t("on-success",a.file.url)},g=()=>{c({type:"error",message:"上传失败"}),p.value=!1};return(e,t)=>{const a=o("el-button"),s=o("el-upload");return i(),l("div",null,[n(s,{action:`${u.value}/fileUploadAndDownload/upload`,"before-upload":m,headers:{"x-token":d(h).token},"on-error":g,"on-success":f,"show-file-list":!1,class:"upload-btn"},{default:r((()=>[n(a,{size:"small",type:"primary"},{default:r((()=>[b])),_:1})])),_:1},8,["action","headers"])])}}});export{y as U,v as _,p as d,m as e,h as g};
