/*! 
 Build based on gin-vue-admin 
 Time : 1654839698000 */
var e=(e,l,a)=>new Promise(((t,i)=>{var u=e=>{try{d(a.next(e))}catch(l){i(l)}},o=e=>{try{d(a.throw(e))}catch(l){i(l)}},d=e=>e.done?t(e.value):Promise.resolve(e.value).then(u,o);d((a=a.apply(e,l)).next())}));import l from"./gin-vue-admin-fieldDialog.1654839698000.js";import a from"./gin-vue-admin-previewCodeDialg.1654839698000.js";import{a as t,b as i,t as u,c as o}from"./gin-vue-admin-stringFun.1654839698000.js";import{p as d,c as n,g as s,a as r,b as m,d as c,e as p}from"./gin-vue-admin-autoCode.1654839698000.js";import{u as v}from"./gin-vue-admin-dictionary.1654839698000.js";import{_ as f,L as b,u as g,a as y,r as N,P as h,b as k,o as _,c as x,d as V,e as C,w,F as T,z as U,ad as z,q as S,f as F,h as j,p as D,l as L,i as q,ae as J}from"../gva/gin-vue-admin-index.1654839698000.js";import"./gin-vue-admin-sysDictionary.1654839698000.js";import"./gin-vue-admin-warningBar.1654839698000.js";const A=l=>e(this,null,(function*(){const e=v();return yield e.getDictionary(l),e.dictionaryMap[l]}));const O=e=>(D("data-v-2e7807fe"),e=e(),L(),e),P={class:"gva-search-box"},E={style:{fontSize:"16px",paddingLeft:"20px"}},M=j(" 点这里从现有数据库创建代码 "),$=j("使用此表创建"),B={class:"gva-search-box"},I=O((()=>V("div",null," 自动创建API ",-1))),R=O((()=>V("div",null," 自动移动文件 ",-1))),X={class:"gva-table-box"},G={class:"gva-btn-list"},H=j("新增Field"),K=j("编辑"),Q=j("上移"),W=j("下移"),Y=O((()=>V("p",null,"确定删除吗？",-1))),Z={style:{"text-align":"right","margin-top":"8px"}},ee=j("取消"),le=j("确定"),ae=j("删除"),te={class:"gva-btn-list justify-content-flex-end auto-btn-list"},ie=j("预览代码"),ue=j("生成代码"),oe={class:"dialog-footer"},de=j("取 消"),ne=j("确 定"),se={class:"previewCodeTool"},re=O((()=>V("p",null,"操作栏：",-1))),me=j("全选"),ce=j("复制"),pe={class:"dialog-footer",style:{"padding-top":"14px","padding-right":"14px"}},ve=j("确 定"),fe={name:"AutoCode"};var be=f(Object.assign(fe,{setup(v){const f={fieldName:"",fieldDesc:"",fieldType:"",dataType:"",fieldJson:"",columnName:"",dataTypeLong:"",comment:"",fieldSearchType:"",dictType:""},j=b(),D=g(),L=y([]),O=N({}),fe=N({dbName:"",tableName:""}),be=N([]),ge=N([]),ye=N(""),Ne=N({}),he=N({structName:"",tableName:"",packageName:"",package:"",abbreviation:"",description:"",autoCreateApiToSql:!1,autoMoveFile:!1,fields:[]}),ke=N({structName:[{required:!0,message:"请输入结构体名称",trigger:"blur"}],abbreviation:[{required:!0,message:"请输入结构体简称",trigger:"blur"}],description:[{required:!0,message:"请输入结构体描述",trigger:"blur"}],packageName:[{required:!0,message:"文件名称：sysXxxxXxxx",trigger:"blur"}],package:[{required:!0,message:"请选择package",trigger:"blur"}]}),_e=N({}),xe=N({}),Ve=N(!1),Ce=N(!1),we=N(null),Te=()=>{we.value.selectText()},Ue=()=>{we.value.copy()},ze=e=>{Ve.value=!0,e?(ye.value="edit",xe.value=JSON.parse(JSON.stringify(e)),_e.value=e):(ye.value="add",_e.value=JSON.parse(JSON.stringify(f)))},Se=J(),Fe=()=>{Se.refs.fieldDialogNode.fieldDialogFrom.validate((e=>{if(!e)return!1;_e.value.fieldName=i(_e.value.fieldName),"add"===ye.value&&he.value.fields.push(_e.value),Ve.value=!1}))},je=()=>{"edit"===ye.value&&(_e.value=xe.value),Ve.value=!1},De=N(null),Le=l=>e(this,null,(function*(){return he.value.fields.length<=0?(q({type:"error",message:"请填写至少一个field"}),!1):he.value.fields.some((e=>e.fieldName===he.value.structName))?(q({type:"error",message:"存在与结构体同名的字段"}),!1):void De.value.validate((a=>e(this,null,(function*(){var e;if(!a)return!1;for(const l in he.value)"string"==typeof he.value[l]&&(he.value[l]=he.value[l].trim());if(he.value.structName=i(he.value.structName),he.value.tableName=he.value.tableName.replace(" ",""),he.value.tableName||(he.value.tableName=u(t(he.value.structName))),he.value.structName===he.value.abbreviation)return q({type:"error",message:"structName和struct简称不能相同"}),!1;if(he.value.humpPackageName=u(he.value.packageName),l){const e=yield d(he.value);O.value=e.data.autoCode,Ce.value=!0}else{const l=yield n(he.value);if("false"===(null==(e=l.headers)?void 0:e.success))return;if(he.value.autoMoveFile)return void q({type:"success",message:"自动化代码创建成功，自动移动成功"});q({type:"success",message:"自动化代码创建成功，正在下载"});const a=new Blob([l]),t="ginvueadmin.zip";if("download"in document.createElement("a")){const e=window.URL.createObjectURL(a),l=document.createElement("a");l.style.display="none",l.href=e,l.setAttribute("download",t),document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(e)}else window.navigator.msSaveBlob(a,t)}}))))})),qe=()=>e(this,null,(function*(){const e=yield c();0===e.code&&(be.value=e.data.dbs)})),Je=()=>e(this,null,(function*(){const e=yield s({dbName:fe.value.dbName});0===e.code&&(ge.value=e.data.tables),fe.value.tableName=""})),Ae=()=>e(this,null,(function*(){const e=["id","created_at","updated_at","deleted_at"],l=yield r(fe.value);if(0===l.code){const a=o(fe.value.tableName);he.value.structName=i(a),he.value.tableName=fe.value.tableName,he.value.packageName=a,he.value.abbreviation=a,he.value.description=a+"表",he.value.autoCreateApiToSql=!0,he.value.fields=[],l.data.columns&&l.data.columns.forEach((l=>{if(!e.some((e=>e===l.columnName))){const e=o(l.columnName);he.value.fields.push({fieldName:i(e),fieldDesc:l.columnComment||e+"字段",fieldType:Ne.value[l.dataType],dataType:l.dataType,fieldJson:e,dataTypeLong:l.dataTypeLong&&l.dataTypeLong.split(",")[0],columnName:l.columnName,comment:l.columnComment,fieldSearchType:"",dictType:""})}}))}})),Oe=()=>e(this,null,(function*(){["string","int","bool","float64","time.Time"].forEach((l=>e(this,null,(function*(){const e=yield A(l);e&&e.forEach((e=>{Ne.value[e.label]=l}))}))))})),Pe=l=>e(this,null,(function*(){const e=yield p({id:Number(l)});0===e.code&&(he.value=JSON.parse(e.data.meta))})),Ee=N([]),Me=()=>e(this,null,(function*(){const e=yield m();0===e.code&&(Ee.value=e.data.pkgs)})),$e=()=>{D.push({name:"autoPkg"})},Be=()=>{qe(),Oe(),Me();const e=j.params.id;e&&Pe(e)};return Be(),h((()=>j.params.id),(e=>{Be()})),(e,i)=>{const u=k("pointer"),o=k("el-icon"),d=k("el-option"),n=k("el-select"),s=k("el-form-item"),r=k("el-button"),m=k("el-form"),c=k("el-collapse-item"),p=k("el-collapse"),v=k("el-input"),f=k("refresh"),b=k("document-add"),g=k("el-tooltip"),y=k("el-checkbox"),N=k("el-table-column"),h=k("el-popover"),j=k("el-table"),D=k("el-dialog");return _(),x("div",null,[V("div",P,[C(p,{modelValue:L,"onUpdate:modelValue":i[2]||(i[2]=e=>z(L)?L.value=e:null),style:{"margin-bottom":"12px"}},{default:w((()=>[C(c,{name:"1"},{title:w((()=>[V("div",E,[M,C(o,{class:"header-icon"},{default:w((()=>[C(u)])),_:1})])])),default:w((()=>[C(m,{ref:"getTableForm",style:{"margin-top":"24px"},inline:!0,model:fe.value,"label-width":"120px"},{default:w((()=>[C(s,{label:"数据库名",prop:"structName"},{default:w((()=>[C(n,{modelValue:fe.value.dbName,"onUpdate:modelValue":i[0]||(i[0]=e=>fe.value.dbName=e),filterable:"",placeholder:"请选择数据库",onChange:Je},{default:w((()=>[(_(!0),x(T,null,U(be.value,(e=>(_(),S(d,{key:e.database,label:e.database,value:e.database},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),C(s,{label:"表名",prop:"structName"},{default:w((()=>[C(n,{modelValue:fe.value.tableName,"onUpdate:modelValue":i[1]||(i[1]=e=>fe.value.tableName=e),disabled:!fe.value.dbName,filterable:"",placeholder:"请选择表"},{default:w((()=>[(_(!0),x(T,null,U(ge.value,(e=>(_(),S(d,{key:e.tableName,label:e.tableName,value:e.tableName},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1}),C(s,null,{default:w((()=>[C(r,{size:"small",type:"primary",onClick:Ae},{default:w((()=>[$])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["modelValue"])]),V("div",B,[C(m,{ref_key:"autoCodeForm",ref:De,rules:ke.value,model:he.value,"label-width":"120px",inline:!0},{default:w((()=>[C(s,{label:"Struct名称",prop:"structName"},{default:w((()=>[C(v,{modelValue:he.value.structName,"onUpdate:modelValue":i[3]||(i[3]=e=>he.value.structName=e),placeholder:"首字母自动转换大写"},null,8,["modelValue"])])),_:1}),C(s,{label:"TableName",prop:"tableName"},{default:w((()=>[C(v,{modelValue:he.value.tableName,"onUpdate:modelValue":i[4]||(i[4]=e=>he.value.tableName=e),placeholder:"指定表名（非必填）"},null,8,["modelValue"])])),_:1}),C(s,{label:"Struct简称",prop:"abbreviation"},{default:w((()=>[C(v,{modelValue:he.value.abbreviation,"onUpdate:modelValue":i[5]||(i[5]=e=>he.value.abbreviation=e),placeholder:"简称会作为入参对象名和路由group"},null,8,["modelValue"])])),_:1}),C(s,{label:"Struct中文名称",prop:"description"},{default:w((()=>[C(v,{modelValue:he.value.description,"onUpdate:modelValue":i[6]||(i[6]=e=>he.value.description=e),placeholder:"中文描述作为自动api描述"},null,8,["modelValue"])])),_:1}),C(s,{label:"文件名称",prop:"packageName"},{default:w((()=>[C(v,{modelValue:he.value.packageName,"onUpdate:modelValue":i[7]||(i[7]=e=>he.value.packageName=e),placeholder:"生成文件的默认名称(建议为驼峰格式,首字母小写,如sysXxxXxxx)",onBlur:i[8]||(i[8]=e=>{var l,a;(l=he.value)[a="packageName"]=t(l[a])})},null,8,["modelValue"])])),_:1}),C(s,{label:"Package（包）",prop:"package"},{default:w((()=>[C(n,{modelValue:he.value.package,"onUpdate:modelValue":i[9]||(i[9]=e=>he.value.package=e),style:{width:"194px"}},{default:w((()=>[(_(!0),x(T,null,U(Ee.value,(e=>(_(),S(d,{key:e.ID,value:e.packageName,label:e.packageName},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),C(o,{class:"auto-icon",onClick:Me},{default:w((()=>[C(f)])),_:1}),C(o,{class:"auto-icon",onClick:$e},{default:w((()=>[C(b)])),_:1})])),_:1}),C(s,null,{label:w((()=>[C(g,{content:"注：把自动生成的API注册进数据库",placement:"bottom",effect:"light"},{default:w((()=>[I])),_:1})])),default:w((()=>[C(y,{modelValue:he.value.autoCreateApiToSql,"onUpdate:modelValue":i[10]||(i[10]=e=>he.value.autoCreateApiToSql=e)},null,8,["modelValue"])])),_:1}),C(s,null,{label:w((()=>[C(g,{content:"注：自动迁移生成的文件到yaml配置的对应位置",placement:"bottom",effect:"light"},{default:w((()=>[R])),_:1})])),default:w((()=>[C(y,{modelValue:he.value.autoMoveFile,"onUpdate:modelValue":i[11]||(i[11]=e=>he.value.autoMoveFile=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])]),V("div",X,[V("div",G,[C(r,{size:"small",type:"primary",onClick:i[12]||(i[12]=e=>ze())},{default:w((()=>[H])),_:1})]),C(j,{data:he.value.fields},{default:w((()=>[C(N,{align:"left",type:"index",label:"序列",width:"100"}),C(N,{align:"left",prop:"fieldName",label:"Field名"}),C(N,{align:"left",prop:"fieldDesc",label:"中文名"}),C(N,{align:"left",prop:"fieldJson",label:"FieldJson"}),C(N,{align:"left",prop:"fieldType",label:"Field数据类型",width:"130"}),C(N,{align:"left",prop:"dataTypeLong",label:"数据库字段长度",width:"130"}),C(N,{align:"left",prop:"columnName",label:"数据库字段",width:"130"}),C(N,{align:"left",prop:"comment",label:"数据库字段描述",width:"130"}),C(N,{align:"left",prop:"fieldSearchType",label:"搜索条件",width:"130"}),C(N,{align:"left",prop:"dictType",label:"字典",width:"130"}),C(N,{align:"left",label:"操作",width:"300"},{default:w((e=>[C(r,{size:"small",type:"text",icon:"edit",onClick:l=>ze(e.row)},{default:w((()=>[K])),_:2},1032,["onClick"]),C(r,{size:"small",type:"text",disabled:0===e.$index,onClick:l=>(e=>{if(0===e)return;const l=he.value.fields[e-1];he.value.fields.splice(e-1,1),he.value.fields.splice(e,0,l)})(e.$index)},{default:w((()=>[Q])),_:2},1032,["disabled","onClick"]),C(r,{size:"small",type:"text",disabled:e.$index+1===he.value.fields.length,onClick:l=>(e=>{if(e===he.value.fields.length-1)return;const l=he.value.fields[e+1];he.value.fields.splice(e+1,1),he.value.fields.splice(e,0,l)})(e.$index)},{default:w((()=>[W])),_:2},1032,["disabled","onClick"]),C(h,{visible:e.row.visible,"onUpdate:visible":l=>e.row.visible=l,placement:"top"},{reference:w((()=>[C(r,{size:"small",type:"text",icon:"delete",onClick:l=>e.row.visible=!0},{default:w((()=>[ae])),_:2},1032,["onClick"])])),default:w((()=>[Y,V("div",Z,[C(r,{size:"small",type:"text",onClick:l=>e.row.visible=!1},{default:w((()=>[ee])),_:2},1032,["onClick"]),C(r,{type:"primary",size:"small",onClick:l=>{return a=e.$index,void he.value.fields.splice(a,1);var a}},{default:w((()=>[le])),_:2},1032,["onClick"])])])),_:2},1032,["visible","onUpdate:visible"])])),_:1})])),_:1},8,["data"]),V("div",te,[C(r,{size:"small",type:"primary",onClick:i[13]||(i[13]=e=>Le(!0))},{default:w((()=>[ie])),_:1}),C(r,{size:"small",type:"primary",onClick:i[14]||(i[14]=e=>Le(!1))},{default:w((()=>[ue])),_:1})])]),C(D,{modelValue:Ve.value,"onUpdate:modelValue":i[15]||(i[15]=e=>Ve.value=e),title:"组件内容"},{footer:w((()=>[V("div",oe,[C(r,{size:"small",onClick:je},{default:w((()=>[de])),_:1}),C(r,{size:"small",type:"primary",onClick:Fe},{default:w((()=>[ne])),_:1})])])),default:w((()=>[Ve.value?(_(),S(l,{key:0,ref:"fieldDialogNode","dialog-middle":_e.value},null,8,["dialog-middle"])):F("",!0)])),_:1},8,["modelValue"]),C(D,{modelValue:Ce.value,"onUpdate:modelValue":i[17]||(i[17]=e=>Ce.value=e)},{title:w((()=>[V("div",se,[re,C(r,{size:"small",type:"primary",onClick:Te},{default:w((()=>[me])),_:1}),C(r,{size:"small",type:"primary",onClick:Ue},{default:w((()=>[ce])),_:1})])])),footer:w((()=>[V("div",pe,[C(r,{size:"small",type:"primary",onClick:i[16]||(i[16]=e=>Ce.value=!1)},{default:w((()=>[ve])),_:1})])])),default:w((()=>[Ce.value?(_(),S(a,{key:0,ref_key:"previewNode",ref:we,"preview-code":O.value},null,8,["preview-code"])):F("",!0)])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-2e7807fe"]]);export{be as default};
