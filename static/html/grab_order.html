<html>

<head>
    <title>grab</title>
    <script src="/static/js/common.js?r=8" type="text/javascript"></script>
    <script src="/static/js/jquery.min.js" type="text/javascript" ></script>
</head>
<style>
    table
    {
        border-collapse: collapse;
        /*margin: 0 auto;*/
        text-align: left;
    }
    table td, table th
    {
        border: 1px solid #cad9ea;
        color: #666;
        height: 30px;
    }
    table thead th
    {
        background-color: #CCE8EB;
        width: 100px;
    }
    table tr:nth-child(odd)
    {
        background: #fff;
    }
    table tr:nth-child(even) {
        background: #F5FAFA;
    }

    .portlet {
        border:1px solid #ff0000;
        margin:5px;
    }

    .hr-double {
        border: 0;
        border-top: 3px double #d0d0d5;
    }

</style>

<body>

<div>

    <div class='table' id="pay_category" style="float: left;padding-left: 2px;" >

    </div>

    <div class='table' id="settings" style="float: left;padding-left: 20px;"   >

    </div>

    <div class='table' id="amount_range"  style="float: left;padding-left: 20px;"   >

    </div>

</div>

<div></div>

<hr class="hr-double" style="clear: both">


<div class='table' id="order_bucket_list" style="clear: both;">

</div>

<hr class="hr-double" style="clear: both">

<div class='table' id="user_bucket_amount_range_list" style="clear: both;">

</div>


<hr class="hr-double" style="clear: both">

<div class='table' id="user_total" style="clear: both;">

</div>

<hr class="hr-double" style="clear: both">

<script>
    var category_list = new Object();
    //入口
    $(document).ready(function(){
        request(init_pay_category,"grab_order_get_pay_category","",false,"GET",null,null);
        request(init_data_order_bucket,"grab_order_order_list","",false,"GET",null,null);
        request(init_grab_data,"grab_order_get_data","",false,"GET",null,null);

    });

    function user_open_auto_grab(uid){

    }

    function init_pay_category(data){
        var pay_category = $("#pay_category");
        var html = "<table><tr><td>id</td><td>支付类型</td></tr>";
        for(var i=0;i<data.length;i++){
            category_list[data[i]["id"]] = data[i]["name"];
            html += "<tr>";
            html += "<td>"+data[i]["id"]+"</td>"
            html += "<td>"+data[i]["name"]+"</td>"
            html += "</tr>";
        }
        html += "</table>";
        pay_category.html(html);
    }

    function init_data_order_bucket(data){
        var order_bucket_list_div = $("#order_bucket_list");
        var bucket_list_data_html = "<table><tr><td>订单</td></tr>";
        for (let categoryId in data) {
            bucket_list_data_html += "<tr><td>"+category_list[categoryId]+"("+categoryId+")</td>"
            var bucket_list = data[categoryId];
            console.log("bucket_list:",bucket_list);
            if (!bucket_list.list || isEmptyObject(bucket_list.list)){
                bucket_list_data_html += "<td>数据-空</td></tr>";
                continue;
            }
            for (let key_2 in bucket_list.list) {
                var row = bucket_list.list[key_2];
                bucket_list_data_html += "<td>"+row.id+"</td><td>"+row.amount+"</td><td>"+row.start_time+"</td><td>"+row.timeout+"</td><td>"+row.success_time+"</td><td>"+grab_uid+"</td>";
            }
            bucket_list_data_html += "</tr>"
        }
        bucket_list_data_html += "</table>";
        order_bucket_list_div.html(bucket_list_data_html);
    }

    function init_grab_data(data){
        init_grab_data_amount(data.amount_range.range);
        init_grab_data_settings(data.settings);
        init_grab_data_user_bucket_amount_range_list(data.user_bucket_amount_range_list);
        init_grab_data_user_total(data.user_total.user_element_list);
    }
    function init_grab_data_user_total(data){
        console.log("user total:",data)
        var html_div = $("#user_total");
        var html ="<table><tr><td>开启抢单用户</td></tr>";
        html += "<tr><td>uid</td><td>ws_status</td><td>create_time</td><td>failed_time</td><td>success_time</td><td>grab_amount</td><td>grab_amount_progress</td></tr>";
        for (let key in data) {
            html += "<tr><td>"+data[key].uid+"</td><td>"+data[key].ws_status+"</td><td>"+data[key].create_time+"</td>";
            html += "<td>"+data[key].user_day_total.failed_time+"</td>";
            html += "<td>"+data[key].user_day_total.success_time+"</td>"
            html += "<td>"+data[key].user_day_total.grab_amount+"</td>";
            html += "<td>"+data[key].user_day_total.grab_amount_progress+"</td>";
            html += "</br>";
        }

        html += "</table>";
        html_div.html(html);
    }
    function init_grab_data_settings(data){
        // console.log("dddd:",data);
        var html_div = $("#settings");
        var html = "<table><tr><td>settings</td></tr>";
        for (let key in data) {
            html += "<tr><td>"+key+"</td><td>"+data[key]+"</td></tr>"
        }
        html += "</table>";
        html_div.html(html);
    }

    function init_grab_data_amount(data){
        var amount_range_div = $("#amount_range");
        var amount_range_div_html = "<table><tr><td colspan=3>金额区间</td></tr>";
        for (let key in data) {
            amount_range_div_html += "<tr><td>"+data[key].min_amount+"</td><td>~</td><td>"+data[key].max_amount+"</td></tr>"
        }
        amount_range_div_html += "</table>";
        amount_range_div.html(amount_range_div_html);
    }

    function init_grab_data_user_bucket_amount_range_list(data){
        var html_div = $("#user_bucket_amount_range_list");
        var html = "";

        console.log("init_grab_data_user_total:",data)
        for (let key in data) {
            html += "<table>";
            html += "<tr><td></td><td>"+category_list[key]+"</td>";

            var row = data[key];
            for (let key_2 in row ) {
                html += "<tr><td>redis queue:</td><td>"+row[key_2].queue_redis.key+"</td></tr>";
            }

            html + "</tr>";

            html += "</table>";
        }

        html_div.html(html);
    }


</script>

</body>

</html>